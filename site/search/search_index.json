{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Analysis Facility Docs Logging in to the UChicago Analysis Facility First you will need to sign up on the Analysis Facility website . Please use your institutional or CERN identity (lxplus username) when signing up, as this will make the approval process smoother. As part of signing up you will need to upload an SSH Public Key. If you are not sure if you have generated an SSH Public Key before, try the following command (Mac/Linux) on your laptop to print the content of the file that contains the SSH Public Key: cat ~/.ssh/id_rsa.pub If the file exists, you should be able to copy the contents of this file to your profile on the AF website. Important: Do not copy the contents of a file that does not end in .pub. You must only upload the public (.pub) part of the key. If you do not have a public key (the file doesn't exist), you can generate one via the following command (Mac/Linux): ssh-keygen -t rsa Upload the resulting public key (ending in .pub) to your profile. Once you have uploaded a key, it will take a little bit of time to process your profile and add your account to the system. After 10-15 minutes, you ought to be able to login via SSH: ssh <username>@login.af.uchicago.edu If it does not work, please double check that you have been approved, have a public key uploaded and have waited at least 15 minutes. If you still have an issue, feel free to reach out to us for help. Submitting to the Analyis Facility The UChicago Analysis Facility uses HTCondor for batch workloads. You will need to define an executable script and a \"submit\" file that describes your job. A simple job that loads the ATLAS environment looks something like this: Job script, called myjob.sh: #!/bin/bash export ATLAS_LOCAL_ROOT_BASE=/cvmfs/atlas.cern.ch/repo/ATLASLocalRootBase export ALRB_localConfigDir=$HOME/localConfig source ${ATLAS_LOCAL_ROOT_BASE}/user/atlasLocalSetup.sh # at this point, you can lsetup root, rucio, athena, etc.. Submit file, called myjob.sub: Universe = vanilla Output = myjob.$(Cluster).$(Process).out Error = myjob.$(Cluster).$(Process).err Log = myjob.log Executable = myjob.sh request_memory = 1GB request_cpus = 1 Queue 1 The condor_submit command is used to queue jobs: $ condor_submit myjob.sub Submitting job(s). 1 job(s) submitted to cluster 17. And the condor_q command is used to view the queue: [lincolnb@login01 ~]$ condor_q -- Schedd: head01.af.uchicago.edu : &lt;192.170.240.14:9618?... @ 07/22/21 11:28:26 OWNER BATCH_NAME SUBMITTED DONE RUN IDLE TOTAL JOB_IDS lincolnb ID: 17 7/22 11:27 _ 1 _ 1 17.0 Total for query: 1 jobs; 0 completed, 0 removed, 0 idle, 1 running, 0 held, 0 suspended Total for lincolnb: 1 jobs; 0 completed, 0 removed, 0 idle, 1 running, 0 held, 0 suspended Total for all users: 1 jobs; 0 completed, 0 removed, 0 idle, 1 running, 0 held, 0 suspended Configuring your jobs to use an X509 Proxy Certificate If you need to use an X509 Proxy, e.g. to access ATLAS Data, you will want to copy your X509 certificate to the Analysis Facility. Store your certificate in $HOME/.globus and create a ATLAS VOMS proxy in the usual way: export ATLAS_LOCAL_ROOT_BASE=/cvmfs/atlas.cern.ch/repo/ATLASLocalRootBase export ALRB_localConfigDir=$HOME/localConfig source ${ATLAS_LOCAL_ROOT_BASE}/user/atlasLocalSetup.sh lsetup emi voms-proxy-init -voms atlas -out $HOME/x509proxy You will want to generate the proxy on, or copy it to, the shared $HOME filesystem so that the HTCondor scheduler can find and read the proxy. With the following additions to your jobscript, HTCondor will configure the job enviroment automatically for X509 authenticated data access: use_x509userproxy = true x509userproxy = /home/YOURUSERNAME/x509proxy E.g., in the job above for the user lincolnb: Universe = vanilla Output = myjob.$(Cluster).$(Process).out Error = myjob.$(Cluster).$(Process).err Log = myjob.log Executable = myjob.sh use_x509userproxy = true x509userproxy = /home/lincolnb/x509proxy request_memory = 1GB request_cpus = 1 Queue 1 Using Analysis Facility Filesystems The UChicago analysis faciltiy has three filesystems that you should be aware of when running workloads. The table below describes their differences: Filesystem Quota Path Backup Notes $HOME 100 GB /home/$USER Yes Solid-state filesystem, shared to all worker nodes $WORK 10 TB /work/$USER No CephFS filesystem, shared to all worker nodes $SCRATCH n/a /scratch No Ephemeral storage for workloads, local to worker nodes When submitting jobs, you should try to use the local scratch filesystem whenever possible. This will help you be a \"good neighbor\" to other users on the system, and reduce overall stress on the shared filesystems, which can lead to slowness, downtimes, etc. By default, jobs start in the $SCRATCH directory on the worker nodes. Output data will need to be staged to the shared filesystem or it will be lost! In the following example, data is read from Rucio, we pretend to process it, and then push a small output copied back to the $HOME filesystem. It assumes your X509 proxy certificate is valid and in your home directory. #!/bin/bash export ATLAS_LOCAL_ROOT_BASE=/cvmfs/atlas.cern.ch/repo/ATLASLocalRootBase export ALRB_localConfigDir=$HOME/localConfig source ${ATLAS_LOCAL_ROOT_BASE}/user/atlasLocalSetup.sh lsetup rucio rucio --verbose download --rse MWT2_DATADISK data16_13TeV:AOD.11071822._001488.pool.root.1 # You can run things like asetup as well asetup AnalysisBase,21.2.81 # This is where you would do your data analysis via AnalysisBase, etc. We will # just pretend to do that, and truncate the file to simulate generating an # output file. This is definitely not what you want to do in a real analysis! cd data16_13TeV truncate --size 10MB AOD.11071822._001488.pool.root.1 cp AOD.11071822._001488.pool.root.1 $HOME/myjob.output It gets submitted in the usual way: Universe = vanilla Output = myjob.$(Cluster).$(Process).out Error = myjob.$(Cluster).$(Process).err Log = myjob.log Executable = myjob.sh use_x509userproxy = true x509userproxy = /home/lincolnb/x509proxy request_memory = 1GB request_cpus = 1 Queue 1 And then: $ condor_submit myjob.sub Submitting job(s). 1 job(s) submitted to cluster 17. Using Docker / Singularity containers (Advanced) Some users may want to bring their own container-based workloads to the Analysis Facility. We support both Docker-based jobs as well as Singularity-based jobs. Additionally, the CVMFS repository unpacked.cern.ch is mounted on all nodes. If, for whatever reason, you wanted to run a Debian Linux-based container on the Analysis Facilty, it would be as simple as the following Job file: universe = docker docker_image = debian executable = /bin/cat arguments = /etc/hosts should_transfer_files = YES when_to_transfer_output = ON_EXIT output = out.$(Process) error = err.$(Process) log = log.$(Process) request_memory = 1000M queue 1 Similarly, if you would like to run a Singualrity container, such as the ones provided in th unpacked.cern.ch CVMFS repo, you can submit a normal vanilla universe job, with a job executable that looks something like the following: #!/bin/bash singularity run -B /cvmfs -B /home /cvmfs/unpacked.cern.ch/registry.hub.docker.com/atlas/rucio-clients:default rucio --version Replacing the rucio-clients:default container and rucio --version executable with your preferred software.","title":"Analysis Facility Docs"},{"location":"#analysis-facility-docs","text":"","title":"Analysis Facility Docs"},{"location":"#logging-in-to-the-uchicago-analysis-facility","text":"First you will need to sign up on the Analysis Facility website . Please use your institutional or CERN identity (lxplus username) when signing up, as this will make the approval process smoother. As part of signing up you will need to upload an SSH Public Key. If you are not sure if you have generated an SSH Public Key before, try the following command (Mac/Linux) on your laptop to print the content of the file that contains the SSH Public Key: cat ~/.ssh/id_rsa.pub If the file exists, you should be able to copy the contents of this file to your profile on the AF website. Important: Do not copy the contents of a file that does not end in .pub. You must only upload the public (.pub) part of the key. If you do not have a public key (the file doesn't exist), you can generate one via the following command (Mac/Linux): ssh-keygen -t rsa Upload the resulting public key (ending in .pub) to your profile. Once you have uploaded a key, it will take a little bit of time to process your profile and add your account to the system. After 10-15 minutes, you ought to be able to login via SSH: ssh <username>@login.af.uchicago.edu If it does not work, please double check that you have been approved, have a public key uploaded and have waited at least 15 minutes. If you still have an issue, feel free to reach out to us for help.","title":"Logging in to the UChicago Analysis Facility"},{"location":"#submitting-to-the-analyis-facility","text":"The UChicago Analysis Facility uses HTCondor for batch workloads. You will need to define an executable script and a \"submit\" file that describes your job. A simple job that loads the ATLAS environment looks something like this: Job script, called myjob.sh: #!/bin/bash export ATLAS_LOCAL_ROOT_BASE=/cvmfs/atlas.cern.ch/repo/ATLASLocalRootBase export ALRB_localConfigDir=$HOME/localConfig source ${ATLAS_LOCAL_ROOT_BASE}/user/atlasLocalSetup.sh # at this point, you can lsetup root, rucio, athena, etc.. Submit file, called myjob.sub: Universe = vanilla Output = myjob.$(Cluster).$(Process).out Error = myjob.$(Cluster).$(Process).err Log = myjob.log Executable = myjob.sh request_memory = 1GB request_cpus = 1 Queue 1 The condor_submit command is used to queue jobs: $ condor_submit myjob.sub Submitting job(s). 1 job(s) submitted to cluster 17. And the condor_q command is used to view the queue: [lincolnb@login01 ~]$ condor_q -- Schedd: head01.af.uchicago.edu : &lt;192.170.240.14:9618?... @ 07/22/21 11:28:26 OWNER BATCH_NAME SUBMITTED DONE RUN IDLE TOTAL JOB_IDS lincolnb ID: 17 7/22 11:27 _ 1 _ 1 17.0 Total for query: 1 jobs; 0 completed, 0 removed, 0 idle, 1 running, 0 held, 0 suspended Total for lincolnb: 1 jobs; 0 completed, 0 removed, 0 idle, 1 running, 0 held, 0 suspended Total for all users: 1 jobs; 0 completed, 0 removed, 0 idle, 1 running, 0 held, 0 suspended","title":"Submitting to the Analyis Facility"},{"location":"#configuring-your-jobs-to-use-an-x509-proxy-certificate","text":"If you need to use an X509 Proxy, e.g. to access ATLAS Data, you will want to copy your X509 certificate to the Analysis Facility. Store your certificate in $HOME/.globus and create a ATLAS VOMS proxy in the usual way: export ATLAS_LOCAL_ROOT_BASE=/cvmfs/atlas.cern.ch/repo/ATLASLocalRootBase export ALRB_localConfigDir=$HOME/localConfig source ${ATLAS_LOCAL_ROOT_BASE}/user/atlasLocalSetup.sh lsetup emi voms-proxy-init -voms atlas -out $HOME/x509proxy You will want to generate the proxy on, or copy it to, the shared $HOME filesystem so that the HTCondor scheduler can find and read the proxy. With the following additions to your jobscript, HTCondor will configure the job enviroment automatically for X509 authenticated data access: use_x509userproxy = true x509userproxy = /home/YOURUSERNAME/x509proxy E.g., in the job above for the user lincolnb: Universe = vanilla Output = myjob.$(Cluster).$(Process).out Error = myjob.$(Cluster).$(Process).err Log = myjob.log Executable = myjob.sh use_x509userproxy = true x509userproxy = /home/lincolnb/x509proxy request_memory = 1GB request_cpus = 1 Queue 1","title":"Configuring your jobs to use an X509 Proxy Certificate"},{"location":"#using-analysis-facility-filesystems","text":"The UChicago analysis faciltiy has three filesystems that you should be aware of when running workloads. The table below describes their differences: Filesystem Quota Path Backup Notes $HOME 100 GB /home/$USER Yes Solid-state filesystem, shared to all worker nodes $WORK 10 TB /work/$USER No CephFS filesystem, shared to all worker nodes $SCRATCH n/a /scratch No Ephemeral storage for workloads, local to worker nodes When submitting jobs, you should try to use the local scratch filesystem whenever possible. This will help you be a \"good neighbor\" to other users on the system, and reduce overall stress on the shared filesystems, which can lead to slowness, downtimes, etc. By default, jobs start in the $SCRATCH directory on the worker nodes. Output data will need to be staged to the shared filesystem or it will be lost! In the following example, data is read from Rucio, we pretend to process it, and then push a small output copied back to the $HOME filesystem. It assumes your X509 proxy certificate is valid and in your home directory. #!/bin/bash export ATLAS_LOCAL_ROOT_BASE=/cvmfs/atlas.cern.ch/repo/ATLASLocalRootBase export ALRB_localConfigDir=$HOME/localConfig source ${ATLAS_LOCAL_ROOT_BASE}/user/atlasLocalSetup.sh lsetup rucio rucio --verbose download --rse MWT2_DATADISK data16_13TeV:AOD.11071822._001488.pool.root.1 # You can run things like asetup as well asetup AnalysisBase,21.2.81 # This is where you would do your data analysis via AnalysisBase, etc. We will # just pretend to do that, and truncate the file to simulate generating an # output file. This is definitely not what you want to do in a real analysis! cd data16_13TeV truncate --size 10MB AOD.11071822._001488.pool.root.1 cp AOD.11071822._001488.pool.root.1 $HOME/myjob.output It gets submitted in the usual way: Universe = vanilla Output = myjob.$(Cluster).$(Process).out Error = myjob.$(Cluster).$(Process).err Log = myjob.log Executable = myjob.sh use_x509userproxy = true x509userproxy = /home/lincolnb/x509proxy request_memory = 1GB request_cpus = 1 Queue 1 And then: $ condor_submit myjob.sub Submitting job(s). 1 job(s) submitted to cluster 17.","title":"Using Analysis Facility Filesystems"},{"location":"#using-docker-singularity-containers-advanced","text":"Some users may want to bring their own container-based workloads to the Analysis Facility. We support both Docker-based jobs as well as Singularity-based jobs. Additionally, the CVMFS repository unpacked.cern.ch is mounted on all nodes. If, for whatever reason, you wanted to run a Debian Linux-based container on the Analysis Facilty, it would be as simple as the following Job file: universe = docker docker_image = debian executable = /bin/cat arguments = /etc/hosts should_transfer_files = YES when_to_transfer_output = ON_EXIT output = out.$(Process) error = err.$(Process) log = log.$(Process) request_memory = 1000M queue 1 Similarly, if you would like to run a Singualrity container, such as the ones provided in th unpacked.cern.ch CVMFS repo, you can submit a normal vanilla universe job, with a job executable that looks something like the following: #!/bin/bash singularity run -B /cvmfs -B /home /cvmfs/unpacked.cern.ch/registry.hub.docker.com/atlas/rucio-clients:default rucio --version Replacing the rucio-clients:default container and rucio --version executable with your preferred software.","title":"Using Docker / Singularity containers (Advanced)"},{"location":"coffeacasa/","text":"First Steps at Coffea-Casa Analysis Facility @ UChicago Prerequisites The primary mode of analysis with coffea-casa is coffea <https://coffeateam.github.io/coffea/index.html> . Coffea provides plenty of examples to users in its documentation <https://coffeateam.github.io/coffea/examples.html> . A good starting point may be this tutorial <https://github.com/CoffeaTeam/coffea-casa-tutorials/blob/master/analysis/analysis_tutorial.ipynb> _ on columnar analysis in coffea. Knowledge of Python <https://docs.python.org/3/tutorial/> is also assumed. Standard coffea analyses are contained within Jupyter Notebooks <https://jupyter.org/> , which allow for dynamic, block-by-block execution of code. Coffea-casa employs the JupyterLab <https://jupyterlab.readthedocs.io/en/stable/user/interface.html> _ interface. JupyterLab is designed for hosting Jupyter Notebooks on the web, and permits the usage of additional features within its environment, including Git access, compatibility with cluster computing tools, and much, much more. If you aren't familiar with any of these tools, please click on the links above for additional resources, and get acquainted with how they work. If you want examples of how coffea-casa merges these tools, refer to the gallery of coffea-casa examples. Access .. important:: Please use https://coffea.af.uchicago.edu <https://coffea.af.uchicago.edu> _ as an access point to the Coffea-Casa Analysis Facility @ UChicago. .. image:: _static/coffea.af.uchicago.edu_hub_login.png :alt: Access to Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center ATLAS AuthZ Authentication Instance Currently Coffea-Casa Analysis Facility @ UChicago can support any member of ATLAS. Sign in with your ATLAS CERN credential: .. image:: _static/atlas-auth.web.cern.ch_login.png :alt: ATLAS Authz authentification to Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center .. image:: _static/coffea-casa-authz-approval.png :alt: Approval required for CMS Authz authentification to Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center Docker Image Selection For high efficient analysis using coffea package, powered with Dask and HTCondor please select: .. image:: _static/coffea.af.uchicago.edu_hub_spawn.png :alt: Coffea Casa analysis image available at Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center After you will be forwarded to your personal Jupyterhub instance running at Analysis Facility @ UChicago: .. image:: _static/coffea.af.uchicago.edu_user_fengping.hu.png :alt: Jupyterhub instance together with Dask Labextention powered cluster available at Coffea-casa Analysis Facility @ UChicago :width: 100% :align: center Cluster Resources in Coffea-Casa Analysis Facility @ UChicago By default, the Coffea-casa Dask cluster should provide you with a scheduler and workers, which you can see by clicking on the colored Dask icon in the left sidebar. .. image:: _static/coffea.af.uchicago.edu_user_clusters.png :alt: Default Dask Labextention powered cluster available Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center As soon as you will start your computations, you will notice that available resources at the Coffea-Casa Analysis Facility @ UChicago can easily autoscale depending on available resources in the HTCondor pool at AF UChicago. .. image:: _static/coffea.af.uchicago.edu_user_clusters.scale.png :alt: Autoscaling with Dask Labextention powered cluster available at Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center Opening a New Console or File There are three ways by which you can open a new tab within coffea-casa. Two are located within the File menu at the very top of the JupyterLab interface: New and New Launcher. .. image:: _static/coffea-casa-newtab.png :alt: The File menu of the coffea-casa JupyterLab interface. :width: 50% :align: center The New dropdown menu allows you to open the console or a file of a specified format directly. The New Launcher option creates a new tab with buttons that permit you to launch a console or a new file, exactly like the interface you are shown when you first open coffea-casa. The final way is specific to the File Browser tab of the sidebar. .. image:: _static/coffea-casa-newlauncher.png :alt: The File Browser tab of the coffea-casa JupyterLab interface, showcasing the New Launcher button. :width: 50% :align: center This behaves exactly like the New Launcher option above. .. note:: Regardless of the method you use to open a new file, the file will be saved to the current directory of your **File Browser.** Using Git Cloning a repository in the Coffea-casa Analysis Facility @ UChicago is simple, though it can be a little confusing because it is spread across two tabs in the sidebar: the File Browser and the Git tabs. In order to clone a repository, first go to the Git tab. It should look like this: .. image:: _static/git.png :alt: The Git tab at Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center Simply click the appropriate button (initialize a repository, or clone a repository) and you'll be hooked up to GitHub. This should then take you to the File Browser tab, which is where you can see all of the repositories you have cloned in your JupyterLab instance. The File Browser should look like this: .. image:: _static/browser.png :alt: The File Browser tab at Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center If you wish to change repositories, simply click the folder button to enter the root directory. If you are in the root directory, the Git tab will reset and allow you to clone another repository. If you wish to commit, push, or pull from the repository you currently have active in the File Browser, then you can return to the Git tab. It should change to look like this, so long as you have a repository open in the File Browser: .. image:: _static/git2.png :alt: The Git tab at Coffea-casa Analysis Facility @ UChicago, after a repository is activated :width: 50% :align: center The buttons in the top right allow for pulling and pushing respectively. When you have edited files in a directory, they will show up under the Changed category, at which point you can hit the + to add them to a commit (at which point they will show up under Staged ). Filling out the box at the bottom of the sidebar will file your commit, and prepare it for you to push. ServiceX When dealing with very large datasets it is often better to do initial data filtering, augmentation using ServiceX <https://iris-hep.org/projects/servicex> _. ServiceX transformation produces output as an Awkward Array. The array can then be used in a regular Coffea processing. Here a scheme explaining the workflow: .. image:: _static/servicex-coffea-workflow.png :alt: ServiceX and Coffea-Casa workflow schema. :width: 80% :align: center There are two different, UC AF deployed ServiceX instances. The only difference between them is the type of input data they are capable of processing. Uproot <https://uproot-atlas.servicex.af.uchicago.edu/> processes any kind of \"flat\" ROOT files, while xAOD <https://xaod.servicex.af.uchicago.edu/> processes only Rucio registered xAOD files. To use them one has to register and get approved. Sign in will lead you to a Globus registration page, where you may choose to use account connected to your institution: .. image:: _static/servicex-registration.png :alt: ServiceX registration. :width: 80% :align: center Once approved, you will be able to see status of your requests in the dashboard: .. image:: _static/servicex-dashboard.png :alt: ServiceX dashboard. :width: 80% :align: center For your code to be able to authenticate your requests, you need to download a servicex.yaml file, that should be placed in your working directory. The file is downloaded from your profile page: .. image:: _static/servicex-profile.png :alt: ServiceX profile. :width: 80% :align: center For an example analysis using ServiceX and Coffea look here. <https://github.com/iris-hep/analysis-grand-challenge/blob/main/workshops/agctools2021/HZZ_analysis_pipeline/HZZ_analysis_pipeline.ipynb> _ More Examples Columnar data analysis with DAOD_PHYSLITE here. <https://github.com/nikoladze/agc-tools-workshop-2021-physlite> _","title":"Coffeacasa"},{"location":"coffeacasa/#first-steps-at-coffea-casa-analysis-facility-uchicago","text":"","title":"First Steps at Coffea-Casa Analysis Facility @ UChicago"},{"location":"coffeacasa/#prerequisites","text":"The primary mode of analysis with coffea-casa is coffea <https://coffeateam.github.io/coffea/index.html> . Coffea provides plenty of examples to users in its documentation <https://coffeateam.github.io/coffea/examples.html> . A good starting point may be this tutorial <https://github.com/CoffeaTeam/coffea-casa-tutorials/blob/master/analysis/analysis_tutorial.ipynb> _ on columnar analysis in coffea. Knowledge of Python <https://docs.python.org/3/tutorial/> is also assumed. Standard coffea analyses are contained within Jupyter Notebooks <https://jupyter.org/> , which allow for dynamic, block-by-block execution of code. Coffea-casa employs the JupyterLab <https://jupyterlab.readthedocs.io/en/stable/user/interface.html> _ interface. JupyterLab is designed for hosting Jupyter Notebooks on the web, and permits the usage of additional features within its environment, including Git access, compatibility with cluster computing tools, and much, much more. If you aren't familiar with any of these tools, please click on the links above for additional resources, and get acquainted with how they work. If you want examples of how coffea-casa merges these tools, refer to the gallery of coffea-casa examples.","title":"Prerequisites"},{"location":"coffeacasa/#access","text":".. important:: Please use https://coffea.af.uchicago.edu <https://coffea.af.uchicago.edu> _ as an access point to the Coffea-Casa Analysis Facility @ UChicago. .. image:: _static/coffea.af.uchicago.edu_hub_login.png :alt: Access to Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center","title":"Access"},{"location":"coffeacasa/#atlas-authz-authentication-instance","text":"Currently Coffea-Casa Analysis Facility @ UChicago can support any member of ATLAS. Sign in with your ATLAS CERN credential: .. image:: _static/atlas-auth.web.cern.ch_login.png :alt: ATLAS Authz authentification to Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center .. image:: _static/coffea-casa-authz-approval.png :alt: Approval required for CMS Authz authentification to Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center","title":"ATLAS AuthZ Authentication Instance"},{"location":"coffeacasa/#docker-image-selection","text":"For high efficient analysis using coffea package, powered with Dask and HTCondor please select: .. image:: _static/coffea.af.uchicago.edu_hub_spawn.png :alt: Coffea Casa analysis image available at Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center After you will be forwarded to your personal Jupyterhub instance running at Analysis Facility @ UChicago: .. image:: _static/coffea.af.uchicago.edu_user_fengping.hu.png :alt: Jupyterhub instance together with Dask Labextention powered cluster available at Coffea-casa Analysis Facility @ UChicago :width: 100% :align: center","title":"Docker Image Selection"},{"location":"coffeacasa/#cluster-resources-in-coffea-casa-analysis-facility-uchicago","text":"By default, the Coffea-casa Dask cluster should provide you with a scheduler and workers, which you can see by clicking on the colored Dask icon in the left sidebar. .. image:: _static/coffea.af.uchicago.edu_user_clusters.png :alt: Default Dask Labextention powered cluster available Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center As soon as you will start your computations, you will notice that available resources at the Coffea-Casa Analysis Facility @ UChicago can easily autoscale depending on available resources in the HTCondor pool at AF UChicago. .. image:: _static/coffea.af.uchicago.edu_user_clusters.scale.png :alt: Autoscaling with Dask Labextention powered cluster available at Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center","title":"Cluster Resources in Coffea-Casa Analysis Facility @ UChicago"},{"location":"coffeacasa/#opening-a-new-console-or-file","text":"There are three ways by which you can open a new tab within coffea-casa. Two are located within the File menu at the very top of the JupyterLab interface: New and New Launcher. .. image:: _static/coffea-casa-newtab.png :alt: The File menu of the coffea-casa JupyterLab interface. :width: 50% :align: center The New dropdown menu allows you to open the console or a file of a specified format directly. The New Launcher option creates a new tab with buttons that permit you to launch a console or a new file, exactly like the interface you are shown when you first open coffea-casa. The final way is specific to the File Browser tab of the sidebar. .. image:: _static/coffea-casa-newlauncher.png :alt: The File Browser tab of the coffea-casa JupyterLab interface, showcasing the New Launcher button. :width: 50% :align: center This behaves exactly like the New Launcher option above. .. note:: Regardless of the method you use to open a new file, the file will be saved to the current directory of your **File Browser.**","title":"Opening a New Console or File"},{"location":"coffeacasa/#using-git","text":"Cloning a repository in the Coffea-casa Analysis Facility @ UChicago is simple, though it can be a little confusing because it is spread across two tabs in the sidebar: the File Browser and the Git tabs. In order to clone a repository, first go to the Git tab. It should look like this: .. image:: _static/git.png :alt: The Git tab at Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center Simply click the appropriate button (initialize a repository, or clone a repository) and you'll be hooked up to GitHub. This should then take you to the File Browser tab, which is where you can see all of the repositories you have cloned in your JupyterLab instance. The File Browser should look like this: .. image:: _static/browser.png :alt: The File Browser tab at Coffea-casa Analysis Facility @ UChicago :width: 50% :align: center If you wish to change repositories, simply click the folder button to enter the root directory. If you are in the root directory, the Git tab will reset and allow you to clone another repository. If you wish to commit, push, or pull from the repository you currently have active in the File Browser, then you can return to the Git tab. It should change to look like this, so long as you have a repository open in the File Browser: .. image:: _static/git2.png :alt: The Git tab at Coffea-casa Analysis Facility @ UChicago, after a repository is activated :width: 50% :align: center The buttons in the top right allow for pulling and pushing respectively. When you have edited files in a directory, they will show up under the Changed category, at which point you can hit the + to add them to a commit (at which point they will show up under Staged ). Filling out the box at the bottom of the sidebar will file your commit, and prepare it for you to push.","title":"Using Git"},{"location":"coffeacasa/#servicex","text":"When dealing with very large datasets it is often better to do initial data filtering, augmentation using ServiceX <https://iris-hep.org/projects/servicex> _. ServiceX transformation produces output as an Awkward Array. The array can then be used in a regular Coffea processing. Here a scheme explaining the workflow: .. image:: _static/servicex-coffea-workflow.png :alt: ServiceX and Coffea-Casa workflow schema. :width: 80% :align: center There are two different, UC AF deployed ServiceX instances. The only difference between them is the type of input data they are capable of processing. Uproot <https://uproot-atlas.servicex.af.uchicago.edu/> processes any kind of \"flat\" ROOT files, while xAOD <https://xaod.servicex.af.uchicago.edu/> processes only Rucio registered xAOD files. To use them one has to register and get approved. Sign in will lead you to a Globus registration page, where you may choose to use account connected to your institution: .. image:: _static/servicex-registration.png :alt: ServiceX registration. :width: 80% :align: center Once approved, you will be able to see status of your requests in the dashboard: .. image:: _static/servicex-dashboard.png :alt: ServiceX dashboard. :width: 80% :align: center For your code to be able to authenticate your requests, you need to download a servicex.yaml file, that should be placed in your working directory. The file is downloaded from your profile page: .. image:: _static/servicex-profile.png :alt: ServiceX profile. :width: 80% :align: center For an example analysis using ServiceX and Coffea look here. <https://github.com/iris-hep/analysis-grand-challenge/blob/main/workshops/agctools2021/HZZ_analysis_pipeline/HZZ_analysis_pipeline.ipynb> _","title":"ServiceX"},{"location":"coffeacasa/#more-examples","text":"Columnar data analysis with DAOD_PHYSLITE here. <https://github.com/nikoladze/agc-tools-workshop-2021-physlite> _","title":"More Examples"}]}